var timer=null;function hideError(){if(timer!=null){window.clearTimeout(timer)}timer=window.setTimeout(function(){$(".error-holder").fadeOut()
},5000)}function showError(b,a){$(".error-holder").removeClass("error-holder-success");
$(".error-holder").css({top:""+a+"px","z-index":"999999"});$(".error-holder span").text(b);
$(".error-holder").fadeIn(function(){hideError()})}function showSuccess(b,a){$(".error-holder").addClass("error-holder-success");
$(".error-holder").css({top:""+a+"px","z-index":"999999"});$(".error-holder span").text(b);
$(".error-holder").fadeIn(function(){hideError()})}$(document).ready(function(){$(".error-holder").on("click",function(){$(this).fadeOut()
})});(function(a){a.fn.makemediadescription=function(k){var b=a(this);var e=k.insidedescription;
b.append('<div id="article-descr" contenteditable="true" class="article-description">'+e+"</div>");
var c=new Date();c=c.getTime();a("body").append('<div class="md-menu-panel" id="'+c+'"><div class="mitem adescr-reset"></div><div class="mitem adescr-bold"></div><div class="mitem adescr-italic"></div><div class="mitem adescr-h2">H2</div><div class="mitem adescr-h3">H3</div><div class="mitem bitem adescr-h4">H4</div><div class="mitem adescr-centered"></div><div class="mitem adescr-strong"></div><div class="mitem adescr-addlink"></div><div class="link-holder"><span class="open-link"></span><input class="href-val" type="text"></div></div>');
var f=a("#"+c);var g=b.find("#article-descr");a.textHighlighter.createWrapper=function(){return a('<span class="temp"></span>')
};g.textHighlighter();function j(l){if(f.find(".link-holder:visible").length){f.find(".link-holder").hide();
f.find(".mitem").show()}if(b.find(".temp").length&&(l=="first")){var n=(b.find(".temp").offset().top)-46;
var m=b.find(".temp").offset().left;f.css({top:n,left:m}).fadeIn("fast")}else{if(a(".md-menu-panel:visible").length&&(l=="change")){if(b.find(".temp").length){var n=b.find(".temp").offset().top-46;
var m=b.find(".temp").offset().left;f.css({top:n,left:m})}else{f.fadeOut("fast")}}else{f.fadeOut("fast")
}}}a(document).on("scroll",function(){j("change")});g.on("scroll",function(){j("change")
});b.on("mouseup",function(){j("first")});f.on("click",".mitem",function(){if(!a(this).hasClass("adescr-addlink")){j("hide")
}});b.on("keydown",function(l){i(l,a(this))});b.on("keypress",function(l){i(l,a(this))
});function i(p,o){if((p.keyCode==8)||(p.keyCode==46)){if(o.find(".temp").length>0){p.preventDefault();
o.find(".temp").first().before('<span id="cursorpos"></span>');var n=document.getElementById("cursorpos");
var l=document.createRange();l.setStartAfter(n);l.collapse(true);var m=window.getSelection();
m.removeAllRanges();m.addRange(l);o.find(".temp").remove();o.find("#cursorpos").remove();
a("p:empty").remove();a("span:empty").remove();a("h2:empty").remove();a("h3:empty").remove();
a("h4:empty").remove();a("a:empty").remove()}}}b.on("mousedown","#article-descr",function(){b.find(".temp").each(function(){a(this).contents().unwrap()
})});function d(m,p){var o="";var l=0;var n=b.find(".temp").length;b.find(".temp").each(function(){l++;
o=o+a(this).text();if((m=="a")&&(a(this).parent().is("a"))){a(this).unwrap()}if(l==n){if(p!=""){if(m=="span"){var s=a(this).after("<"+m+' class="'+p+'">'+o+"</"+m+">");
s.parent().addClass(p).text(s.text());s.remove()}else{if(m=="a"){var q;if(f.find(".open-link").hasClass("active")){q=a(this).after("<"+m+'  href="'+p+'" target="_blank">'+o+"</"+m+">")
}else{q=a(this).after("<"+m+'  href="'+p+'" rel="nofollow" target="_blank">'+o+"</"+m+">")
}if(q.parent().is("a")){q.unwrap()}}}}else{var r=a(this).after("<"+m+">"+o+"</"+m+">");
if(r.parent().attr("id")!=g.attr("id")){r.unwrap()}}}a(this).remove()})}f.on("click",".adescr-bold",function(){d("b","")
});f.on("click",".adescr-italic",function(){d("i","")});f.on("click",".adescr-h2",function(){d("h2","")
});f.on("click",".adescr-h3",function(){d("h3","")});f.on("click",".adescr-h4",function(){d("h4","")
});f.on("click",".adescr-strong",function(){d("strong","")});f.on("click",".adescr-centered",function(){d("span","a-centered")
});f.on("click",".adescr-reset",function(){b.find(".temp").each(function(){if(a(this).parent().attr("id")!=g.attr("id")){a(this).unwrap()
}})});f.on("click",".adescr-addlink",function(){a(this).siblings().fadeOut("fast");
a(this).fadeOut("fast",function(){a(this).next().fadeIn("fast");a(".href-val").focus()
})});f.on("keyup",".href-val",function(m){if(m.keyCode==13){if(a(this).val()!=""){var l=a(this).val();
d("a",l)}a(this).val("");a(this).parent().fadeOut("fast",function(){f.find(".mitem").fadeIn("fast");
f.find(".open-link").removeClass("active")})}});f.on("click",".open-link",function(){a(this).toggleClass("active");
f.find(".href-val").focus()});function h(){g.find("br").each(function(){if((a(this).parent().is("div"))&&(a(this).parent().attr("id"))!=g.attr("id")){a(this).unwrap()
}});g.find(".temp").each(function(){a(this).contents().unwrap()});g.find("div").each(function(){if(a(this).text().length==0){a(this).remove()
}else{a(this).before("<br>");a(this).contents().unwrap()}});g.find("h2:empty").remove();
g.find("h3:empty").remove();g.find("h4:empty").remove();g.find("a:empty").remove();
var l=g.html().replace(/&nbsp;/g,"");return l}return{destroyPluginEvent:function(){b.children().die();
f.children.die()},saveDescription:function(){return h()}};return b}})(jQuery);$(document).ready(function(){$("body").on("focus","#alias",function(){if($(this).val()==""){var a=$("#title").val();
a=a.replace(/ /g,"-").toLowerCase();a=a.replace(/\./g,"-");a=a.replace(/:/g,"");a=a.replace(/,/g,"");
a=a.replace(/;/g,"");a=a.replace(/а/g,"a");a=a.replace(/б/g,"b");a=a.replace(/в/g,"v");
a=a.replace(/г/g,"g");a=a.replace(/д/g,"d");a=a.replace(/е/g,"e");a=a.replace(/ё/g,"yo");
a=a.replace(/ж/g,"j");a=a.replace(/з/g,"z");a=a.replace(/и/g,"i");a=a.replace(/й/g,"i");
a=a.replace(/к/g,"k");a=a.replace(/л/g,"l");a=a.replace(/м/g,"m");a=a.replace(/н/g,"n");
a=a.replace(/о/g,"o");a=a.replace(/п/g,"p");a=a.replace(/р/g,"r");a=a.replace(/с/g,"s");
a=a.replace(/т/g,"t");a=a.replace(/у/g,"u");a=a.replace(/ф/g,"f");a=a.replace(/х/g,"h");
a=a.replace(/ц/g,"c");a=a.replace(/ч/g,"ch");a=a.replace(/ш/g,"sh");a=a.replace(/щ/g,"sch");
a=a.replace(/ъ/g,"");a=a.replace(/ы/g,"y");a=a.replace(/ь/g,"");a=a.replace(/э/g,"e");
a=a.replace(/ю/g,"yu");a=a.replace(/я/g,"ya");$(this).val(a)}})});$(document).ready(function(){$("body").on("click",".p-cancel",function(){$(".popup-holder.dynamic").fadeOut("fast",function(){$(this).remove()
})});$("body").on("click",".checker",function(){$(this).toggleClass("active");var a=$(this).attr("data-relna");
if(a){$("."+a).toggleClass("na")}});$(".check-holder").on("click",".check",function(){if(!$(this).parent(".check-holder").hasClass("na")){if($(this).parents(".check-holder").hasClass("single")){$(this).parents(".check-holder").find(".check").removeClass("active");
$(this).addClass("active")}else{$(this).toggleClass("active")}}});$("body").on("click",".open-bayan",function(){if($(this).hasClass("up")){$(this).next().slideUp("fast");
$(this).removeClass("up")}else{$(this).addClass("up");$(this).next().slideDown("fast")
}})});function tagMeBabe(d,a,h,g,f,c){function b(i){i=i.trim().toLowerCase();var j=true;
d.val("");g.find("."+f).each(function(){if($(this).text()==i){$(this).addClass("double");
j=false}else{$(this).removeClass("double")}});if(j){g.prepend('<div class="'+f+'">'+i+"</div>")
}}function e(i){if(i.val().length>1){var j={};j.key=i.val();j.action="searchtag";
$.ajax({url:c,type:"POST",dataType:"json",data:j,success:function(k){},error:function(k){showError("Ошибка базы данных!","login")
}}).done(function(l){a.children().remove();for(var k=0;k<l.result.length;k++){a.append("<span>"+l.result[k].name+"</span>")
}if(a.children().length>0){a.slideDown(200)}else{a.slideUp(10)}})}}d.on("focus",function(){e($(this))
});d.on("keyup",function(k){var i=$(this).val();var j=$(this);if(k.keyCode==40){if(a.find(".active").length>0){a.find(".active").removeClass("active").next().addClass("active")
}else{a.find("span:first").addClass("active")}j.val(a.find(".active").text())}else{if(k.keyCode==38){if(a.find(".active").length>0){a.find(".active").removeClass("active").prev().addClass("active")
}else{a.find("span:last").addClass("active")}j.val(a.find(".active").text())}else{if(k.keyCode==13){b(i);
a.slideUp(10)}else{e(j)}}}});g.on("click","."+f,function(){$(this).fadeOut(100,function(){$(this).remove()
})});a.on("click","span",function(){b($(this).text());a.slideUp(10)});$(document).mousedown(function(i){if(!$(i.target).is("span")&&(!$(i.target).parent().hasClass(h))){a.slideUp(10,function(){a.children().remove()
})}})}var globalArticleMainImageFileNameToUpload=null;var mediaElement=null;function uploadMainArticleImg(b){globalArticleMainImageFileNameToUpload=b;
if(b!=undefined){if(!b.type.match("image.*")){showError("File type should be an image","popup");
return}var a=new FileReader();a.onload=(function(c){return function(d){if($(".logo-holder.imgarticle img").length){$(".logo-holder.imgarticle img").fadeOut("fast",function(){$(".logo-holder.imgarticle").append('<img src="'+d.target.result+'">');
$(this).remove()})}else{$(".logo-holder.imgarticle").append('<img src="'+d.target.result+'">')
}}})(b);a.readAsDataURL(b)}}$(document).ready(function(){$("body").on("click","#main-article-img",function(){$("#imgarticle").click()
});$("body").on("change","#imgarticle",function(d){var c=d.target.files;var b=c[0];
uploadMainArticleImg(b)});$("#del-main-img").on("click",function(){if($(".logo-holder img").length&&($(".logo-holder img").attr("src").indexOf("noimage")==-1)){$(".logo-holder img").fadeOut("fast",function(){globalArticleMainImageFileNameToUpload=null;
$("#edit-article").addClass("todelete").attr("data-src",$(this).attr("src"));$(this).remove()
});$(".logo-holder").append('<img src="/images/noimage-slide.jpg" alt="noimage" />')
}});if($(".mediaelement").length){var a=$(".mediaelement").find(".mediacontent").html();
mediaElement=$(".mediaelement").makemediadescription({insidedescription:a});window.onbeforeunload=function(){if(!$("#deleted").length){return"Ты сохранил все изменения?"
}}}});$(document).ready(function(){$("#search-article").on("keyup",function(i){if($(this).val().length>1){var h={};
h.key=$(this).val();h.action="searcharticle";h.catid=window.location.href.substr(window.location.href.lastIndexOf("/")+1);
$.ajax({url:"/admin/articles",type:"POST",dataType:"json",data:h,success:function(j){},error:function(j){showError("Ошибка базы данных!","login")
}}).done(function(j){$(".articles").children().remove();$(".articles").append(j.result);
if(j.result.length==0){$(".articles").append('<div class="notfound">Ой... Похоже ничего не найдено!</div>')
}})}});if($("#tags").length){var b=$("#tags");var d=$(".autofill-bar");var c="autofill-bar";
var f=$("#article-tags");var a="t-item";var g="/admin/article";tagMeBabe(b,d,c,f,a,g)
}function e(j,i){if(!i.hasClass("working")){var n=$(".id-info").attr("data-lang");
if(($("#article-categories .active").length>0)||(n!="default")){if($("#title").val().length==0){showError("Введите название статьи!","login")
}else{if((n=="default")&&($("#alias").val().length==0)){showError("Введите URL статьи!","login")
}else{i.addClass("working");var k={};k.action=j;if(j=="editarticle"){k.id=$(".id-info").attr("id")
}k.title=$("#title").val();k.alias=$("#alias").val();k.shortdescription=$("#shortdescription").val();
k.htmltitle=$("#htmltitle").val();k.htmldescription=$("#htmldescription").val();k.htmlkeywords=$("#htmlkeywords").val();
k.moderator=$("#moderator").text();k.parent=$(".id-info").attr("data-parent");k.lang=n;
var m=[];$("#article-categories .active").each(function(){m.push($(this).attr("id"))
});k.categories=m;var h=[];$("#article-tags .t-item").each(function(){h.push($(this).text())
});k.tags=h;k.description=mediaElement.saveDescription();$(".loader").fadeIn("fast");
$.ajax({url:"/admin/article/",type:"POST",dataType:"json",data:k,success:function(o){},error:function(o){showError(o.responseText,"popup");
i.removeClass("working");$(".loader").fadeOut("fast")}}).done(function(q){var o=q.id;
if(globalArticleMainImageFileNameToUpload){var p=new FormData();p.append("fileUpload",globalArticleMainImageFileNameToUpload);
p.append("action","savemainimage");p.append("id",o);var r=new XMLHttpRequest();r.open("post","/admin/article/",true);
r.send(p);r.onreadystatechange=function(s){if(this.readyState==4){if(r.responseText!="Success"){showError(r.responseText,"popup");
i.removeClass("working");$(".loader").fadeOut("fast")}else{l()}}}}else{l()}});function l(){i.removeClass("working");
$(".loader").fadeOut("fast");var o=window.location.href;o=o.substr(0,o.lastIndexOf("/"));
if($(".id-info").attr("data-lang")=="default"){o=o.replace("article","articles")}window.location.href=o
}}}}else{showError("Выберите хотя бы одну категорию!","login")}}}$("#edit-article").on("click",function(){var h=$(this);
if(h.hasClass("todelete")){var i={};i.id=$(".id-info").attr("id");i.action="deletemainimg";
i.file=".."+h.attr("data-src");$.ajax({url:"/admin/article/",type:"POST",dataType:"json",data:i,success:function(j){},error:function(j){showError(j.responseText,"login")
}}).done(function(j){e("editarticle",h)})}e("editarticle",h)});$("#new-article").on("click",function(){var h=$(this);
e("newarticle",h)});$("#delete-article").on("click",function(){$("body").append('<div class="popup-holder dynamic"><div class="popup-content" style="height: 200px; width: 600px; margin-left: -300px; margin-top: -100px;"><div class="popup-header">Удаление статьи</div><div class="full">Вы действительно хотите удалить статью '+$("#title").val()+'?</div><div class="clear centered"><div class="button green" id="yes-delete-article">Удалить</div><div class="button grey p-cancel">Отмена</div></div></div></div>');
$(".popup-holder.dynamic").fadeIn()});$("body").on("click","#yes-delete-article",function(){var h=$(this);
if(!h.hasClass("working")){h.addClass("working");var i={};i.action="deletearticle";
i.id=$(".id-info").attr("id");$.ajax({url:"/admin/article",type:"POST",dataType:"json",data:i,success:function(j){},error:function(j){showError("Невозможно удалить статью!","login");
h.removeClass("working")}}).done(function(k){window.location.href="/admin/categories";
var j=window.location.href;j=j.substr(0,j.lastIndexOf("/"));if($(".id-info").attr("data-lang")=="default"){$(".id-info").attr("id","deleted");
j="/admin/categories"}window.location.href=j})}});$(".articles").on("click",".published span",function(){var i=$(this);
var j={};var h="yes";if(i.hasClass("yes")){h="no"}j.flag=h;j.id=i.parent().parent().attr("id");
j.action="setpublished";$.ajax({url:"/admin/article/",type:"POST",dataType:"json",data:j,success:function(k){},error:function(k){showError("Ошибка базы данных","login")
}}).done(function(k){if(h=="yes"){i.removeClass("no").addClass("yes").text("Опубликована");
showSuccess("Статья опубликована","login")}else{i.removeClass("yes").addClass("no").text("Не опубликована");
showSuccess("Статья снята с публикации","login")}})})});$(document).ready(function(){$("#b-new-category").on("click",function(){$("body").append('<div class="popup-holder dynamic"><div class="popup-content" style="height: 300px; width: 600px; margin-left: -300px; margin-top: -150px;"><div class="popup-header">Создать новую категорию</div><div class="full"><label for="title">Заголовок категории</label><input type="text" id="title"><label for="alias">URL (без домена и /)</label><input type="text" id="alias"></div><div class="clear centered"><div class="button green" id="save-category">Сохранить</div><div class="button grey p-cancel">Отмена</div></div></div></div>');
$(".popup-holder.dynamic").fadeIn()});$("body").on("click","#save-category",function(){var b=$(this);
if(!b.hasClass("working")){b.addClass("working");var c={};c.title=$("#title").val();
c.alias=$("#alias").val();c.pos=$("#sortable li").length;c.action="newcategory";c.moderator=$("#moderator").text();
if(c.title.length==0){showError("Пожалуйста введите заголовок категории!","popup");
b.removeClass("working")}else{if(c.alias.length==0){showError("Пожалуйста введите роут!","popup");
b.removeClass("working")}else{$.ajax({url:"/admin/categories",type:"POST",dataType:"json",data:c,success:function(d){},error:function(d){showError(d.responseText,"popup");
b.removeClass("working")}}).done(function(d){b.removeClass("working");$(".popup-holder.dynamic").fadeOut("fast",function(){$(this).remove()
});$("#sortable").append(d.result)})}}}});function a(){$(".ui-sortable-handle").each(function(){var b={};
b.pos=$(this).prevAll().length;b.id=$(this).attr("id");b.action="posupdate";$.ajax({url:"/admin/categories",type:"POST",dataType:"json",data:b})
})}if($("#sortable").length){$("#sortable").sortable({deactivate:function(b,c){a()
},placeholder:"ui-state-highlight"});$("#sortable").disableSelection()}$("#delete-category").on("click",function(){$("body").append('<div class="popup-holder dynamic"><div class="popup-content" style="height: 200px; width: 600px; margin-left: -300px; margin-top: -100px;"><div class="popup-header">Удаление категории</div><div class="full">Вы действительно хотите удалить категорию '+$("#title").val()+'?</div><div class="clear centered"><div class="button green" id="yes-delete-category">Удалить</div><div class="button grey p-cancel">Отмена</div></div></div></div>');
$(".popup-holder.dynamic").fadeIn()});$("body").on("click","#yes-delete-category",function(){var b=$(this);
if(!b.hasClass("working")){b.addClass("working");var c={};c.id=$(".id-info").attr("id");
c.action="deletecategory";$.ajax({url:"/admin/categories",type:"POST",dataType:"json",data:c,success:function(d){},error:function(d){showError("Невозможно удалить категорию!","login");
b.removeClass("working")}}).done(function(d){$(".id-info").attr("id","deleted");window.location.href="/admin/categories"
})}});$("#edit-category").on("click",function(){var c=$(this);if(!c.hasClass("working")){c.addClass("working");
var d={};d.title=$("#title").val();d.shortdescription=$("#shortdescription").val();
d.htmltitle=$("#htmltitle").val();d.htmldescription=$("#htmldescription").val();d.htmlkeywords=$("#htmlkeywords").val();
d.alias=$("#alias").val();d.menutitle=$("#menutitle").val();d.moderator=$("#moderator").text();
var b="false";if($(".ismain").hasClass("active")){b="true"}d.ismain=b;d.description=mediaElement.saveDescription();
d.id=$(".id-info").attr("id");d.parent=$(".id-info").attr("data-parent");var e=$(".id-info").attr("data-lang");
d.lang=e;d.action="editcategory";$(".loader").fadeIn("fast");$.ajax({url:"/admin/categories",type:"POST",dataType:"json",data:d,success:function(f){},error:function(f){showError(f.responseText,"popup");
c.removeClass("working");$(".loader").fadeOut("fast")}}).done(function(f){var g=f.id;
c.removeClass("working");$(".loader").fadeOut("fast");if($(".id-info").attr("data-lang")=="default"){if($(".crumbs").find("a").length){window.location.href=$(".crumbs").find("a").attr("href")
}else{window.location.href="/admin/categories"}}else{window.location.href=window.location.href.substr(0,window.location.href.lastIndexOf("/"))
}})}})});$(document).ready(function(){var b=/^([a-zA-Z0-9_\-])+$/;var a=/^[a-zA-Z0-9!%&@#$\^*?_~+]+$/;
$("#pass").on("keyup",function(c){if(c.keyCode==13){$(".b-login").click()}});$(".b-login").on("click",function(){var c={};
c.username=$("#username").val();c.password=$("#pass").val();if(c.username==""){showError("Пожалуйста введите свое имя!",50)
}else{if(c.password==""){showError("Пожалуйста введите свой пароль!",50)}else{if(!b.test(c.username)){showError("Недопустимые символы в имени",50)
}else{if(!a.test(c.password)){showError("Недопустимые символы в пароле",50)}else{$.ajax({url:"/login",type:"POST",dataType:"json",data:c,success:function(d){},error:function(d){showError("Неверное имя или пароль!",50)
}}).done(function(d){if(d.link){window.location.href=d.link}else{showError("Неверное имя или пароль!",50)
}})}}}}})});